<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contact Us</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background: #f5f5f5; margin: 0; padding: 24px; }
    .container { max-width: 640px; margin: 0 auto; background: #fff; border: 1px solid #ddd; padding: 18px 22px; box-shadow: 0 0 0 1px rgba(0,0,0,0.02); }
    h1 { font-size: 22px; margin: 0 0 14px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
    .form-group { margin-bottom: 14px; }
    label { display: block; font-weight: 600; margin-bottom: 6px; color: #222; }
    input[type="text"], input[type="email"], textarea, select { width: 100%; padding: 9px 10px; border: 1px solid #cfcfcf; border-radius: 3px; box-sizing: border-box; font-size: 14px; }
    textarea { min-height: 100px; resize: vertical; }
    .radio-group label { margin-right: 12px; font-weight: 400; }
    .actions { margin-top: 8px; }
    input[type="submit"], button { padding: 6px 12px; font-size: 14px; }
    .error { color: #b00020; font-size: 13px; margin-top: 6px; }
    .preview { background: #fafafa; border: 1px solid #ddd; padding: 12px; margin-top: 12px; }
    .field-row { margin-bottom: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Contact Us</h1>

    <!-- Main form: submits via POST to demonstrate POST method -->
    <form id="contactForm" method="post" action="/submit_form" novalidate>
      <div class="form-group">
        <label for="name">Name:</label>
        <input id="name" name="name" type="text">
        <div id="err-name" class="error" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input id="email" name="email" type="text">
        <div id="err-email" class="error" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="phone">Phone Number:</label>
        <input id="phone" name="phone" type="text">
        <div id="err-phone" class="error" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="message">Message:</label>
        <textarea id="message" name="message"></textarea>
        <div id="err-message" class="error" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label>Preferred Contact Method:</label>
        <div class="radio-group">
          <label><input type="radio" name="preferred" value="Email" checked> Email</label>
          <label><input type="radio" name="preferred" value="Phone"> Phone</label>
          <label><input type="radio" name="preferred" value="Both"> Both</label>
        </div>
      </div>

      <div class="form-group">
        <label for="inquiry">Inquiry Type:</label>
        <select id="inquiry" name="inquiry">
          <option value="">Select an option</option>
          <option value="General Inquiry">General Inquiry</option>
          <option value="Support Request">Support Request</option>
          <option value="Feedback">Feedback</option>
        </select>
      </div>

      <div class="actions">
        <input type="submit" value="Submit">
      </div>
      <div class="actions" style="margin-top:8px;">
        <button type="button" id="previewBtn">Preview (GET)</button>
      </div>
    </form>

    <!-- Preview area: populated when preview is requested using GET -->
    <div id="previewArea" class="preview" style="display:none;">
      <strong>Preview</strong>
      <div id="previewContent"></div>
    </div>
  </div>

  <script>
    // ===== UTILITY VALIDATION FUNCTIONS =====
    // These functions check individual field validity: empty check, email format, phone digits.
    function isEmpty(val) { return !val || val.trim() === ''; }
    function validEmail(email) {
      // Allow international characters in local part; simple, permissive check
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    function validPhone(phone) {
      return /^\d{10}$/.test(phone);
    }

    // ===== ERROR MESSAGE DISPLAY =====
    // Clears or sets error message text in the specified error container.
    function showError(id, msg) {
      document.getElementById(id).textContent = msg || '';
    }

    // ===== MAIN VALIDATION FUNCTION =====
    // Validates all required fields and displays validation errors. Returns true if all pass.
    function validateAll() {
      var name = document.getElementById('name').value;
      var email = document.getElementById('email').value;
      var phone = document.getElementById('phone').value;
      var message = document.getElementById('message').value;

      var ok = true;
      if (isEmpty(name)) { showError('err-name', 'Name is required.'); ok = false; } else { showError('err-name', ''); }
      if (isEmpty(email)) { showError('err-email', 'Email is required.'); ok = false; }
      else if (!validEmail(email)) { showError('err-email', 'Please enter a valid email address.'); ok = false; }
      else { showError('err-email', ''); }
      if (isEmpty(phone)) { showError('err-phone', 'Phone number is required.'); ok = false; }
      else if (!validPhone(phone)) { showError('err-phone', 'Phone must contain exactly 10 digits.'); ok = false; }
      else { showError('err-phone', ''); }
      if (isEmpty(message)) { showError('err-message', 'Message is required.'); ok = false; } else { showError('err-message', ''); }
      return ok;
    }

    // ===== FORM SUBMIT HANDLER =====
    // Validates all fields on submit. If valid, sends POST request to server. If invalid, shows errors.
    document.getElementById('contactForm').addEventListener('submit', function(e){
      if (!validateAll()) {
        e.preventDefault();
        document.getElementById('previewArea').style.display = 'none';
      }
      // If valid, form will submit using POST to /submit_form
    });

    // ===== PREVIEW BUTTON HANDLER =====
    // Validates form, then redirects to same page with GET query parameters to show preview.
    document.getElementById('previewBtn').addEventListener('click', function(){
      if (!validateAll()) return;
      var params = new URLSearchParams();
      params.set('name', document.getElementById('name').value);
      params.set('email', document.getElementById('email').value);
      params.set('phone', document.getElementById('phone').value);
      params.set('message', document.getElementById('message').value);
      params.set('preferred', document.querySelector('input[name=preferred]:checked').value);
      params.set('inquiry', document.getElementById('inquiry').value);
      params.set('preview', '1');
      // Use GET by navigating to same page with query string
      window.location.search = params.toString();
    });

    // ===== PAGE LOAD HANDLER =====
    // Detects GET preview parameters on load, populates form, validates, and displays preview if valid.
    window.addEventListener('DOMContentLoaded', function(){
      var qs = new URLSearchParams(window.location.search);
      if (qs.get('preview') === '1') {
        // Restore form state from URL query parameters
        document.getElementById('name').value = qs.get('name') || '';
        document.getElementById('email').value = qs.get('email') || '';
        document.getElementById('phone').value = qs.get('phone') || '';
        document.getElementById('message').value = qs.get('message') || '';
        var pref = qs.get('preferred');
        if (pref) {
          var el = document.querySelector('input[name=preferred][value="' + pref + '"]');
          if (el) el.checked = true;
        }
        var inq = qs.get('inquiry');
        if (inq) document.getElementById('inquiry').value = inq;

        // Validate restored data; show preview only if all validation passes
        if (validateAll()) {
          showPreviewFromParams(qs);
        } else {
          document.getElementById('previewArea').style.display = 'none';
          // focus first error
          var firstErr = document.querySelector('.error:not(:empty)');
          if (firstErr) firstErr.previousElementSibling && firstErr.previousElementSibling.focus && firstErr.previousElementSibling.focus();
        }
      }
    });

    // ===== PREVIEW RENDERER =====
    // Constructs and displays the preview panel with formatted form data.
    function showPreviewFromParams(qs) {
      var html = '';
      html += '<div class="field-row"><strong>Name:</strong> ' + escapeHtml(qs.get('name') || '') + '</div>';
      html += '<div class="field-row"><strong>Email:</strong> ' + escapeHtml(qs.get('email') || '') + '</div>';
      html += '<div class="field-row"><strong>Phone:</strong> ' + escapeHtml(qs.get('phone') || '') + '</div>';
      html += '<div class="field-row"><strong>Preferred Contact:</strong> ' + escapeHtml(qs.get('preferred') || '') + '</div>';
      html += '<div class="field-row"><strong>Inquiry Type:</strong> ' + escapeHtml(qs.get('inquiry') || '') + '</div>';
      html += '<div class="field-row"><strong>Message:</strong><div>' + nl2br(escapeHtml(qs.get('message') || '')) + '</div></div>';
      document.getElementById('previewContent').innerHTML = html;
      document.getElementById('previewArea').style.display = 'block';
    }

    // ===== STRING UTILITY FUNCTIONS =====
    // Escapes HTML special characters to prevent XSS; converts newlines to <br> for display.
    function escapeHtml(s) { if (!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
    function nl2br(s) { return s.replace(/\n/g, '<br>'); }
  </script>
</body>
</html>
